
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="StarryNight - toolkit for optical pooled screening">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../01-algorithm/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Principles - StarryNight</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#core-concepts-design-decisions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="StarryNight" class="md-header__button md-logo" aria-label="StarryNight" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            StarryNight
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Principles
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/broadinstitute/starrynight" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user/getting-started/" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/guides/system-maintenance-guide/" class="md-tabs__link">
          
  
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/00_architecture_overview/" class="md-tabs__link">
          
  
  
    
  
  Developer Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Developer Architecture (v2)

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/validation/testing-framework/" class="md-tabs__link">
          
  
  
    
  
  Developer Testing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/roadmap/requirements/" class="md-tabs__link">
          
  
  
    
  
  Developer Roadmap

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/legacy/pcpip-specs/" class="md-tabs__link">
          
  
  
    
  
  Developer Legacy

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="StarryNight" class="md-nav__button md-logo" aria-label="StarryNight" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    StarryNight
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/broadinstitute/starrynight" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/example-pipeline-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Complete Workflow Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/parser-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parser Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/operational-challenges/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operational Challenges FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/guides/system-maintenance-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/guides/workflow-implementation-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflow Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/00_architecture_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/01_algorithm_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/02_cli_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/03_module_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/04_pipeline_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/05_execution_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/06_configuration_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/07_architecture_for_biologists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture for Biologists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/08_practical_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practical Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/09_architecture_flow_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flow Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developer Architecture (v2)
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developer Architecture (v2)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Principles
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Principles
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pipeline-terminology" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Terminology
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Core Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layered-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Layered Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algorithm-independence" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm Independence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layer-specific-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Layer-Specific Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer-Specific Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specification-vs-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Specification vs Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-layer-as-cli-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      Module Layer as CLI Wrapper
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three-function-pattern-cellprofiler-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Three-Function Pattern (CellProfiler Workflows)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-pipeline-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Module &amp; Pipeline Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Module &amp; Pipeline Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Module Composition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipecraft-as-separate-package" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft as Separate Package
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-cutting-concerns" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Cutting Concerns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Cutting Concerns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#path-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      Path Abstraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-based-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Container-Based Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-inference" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter Inference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-cutting-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Cutting Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-backend" class="md-nav__link">
    <span class="md-ellipsis">
      Execution &amp; Backend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution &amp; Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Abstraction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Development Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Development Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-handling-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling Philosophy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-off-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Trade-off Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../99-0-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/validation/testing-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Framework
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/validation/validation-pipeline-1-illum-calc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Roadmap
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Developer Roadmap
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/roadmap/requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/roadmap/pipeline-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Automation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/roadmap/aws-deployment-roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Deployment Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Legacy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Developer Legacy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/legacy/pcpip-specs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PCPIP Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/legacy/pcpip-pipelines/pcpip-pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PCPIP Reference Pipelines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pipeline-terminology" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Terminology
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Core Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layered-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Layered Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algorithm-independence" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm Independence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layer-specific-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Layer-Specific Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer-Specific Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specification-vs-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Specification vs Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-layer-as-cli-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      Module Layer as CLI Wrapper
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three-function-pattern-cellprofiler-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      Three-Function Pattern (CellProfiler Workflows)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-pipeline-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Module &amp; Pipeline Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Module &amp; Pipeline Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Module Composition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipecraft-as-separate-package" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft as Separate Package
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-cutting-concerns" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Cutting Concerns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Cutting Concerns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#path-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      Path Abstraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-based-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Container-Based Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-inference" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter Inference
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-cutting-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Cutting Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-backend" class="md-nav__link">
    <span class="md-ellipsis">
      Execution &amp; Backend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution &amp; Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      Backend Abstraction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Development Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Development Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-handling-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling Philosophy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Strategy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-off-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Trade-off Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="core-concepts-design-decisions">Core Concepts &amp; Design Decisions</h1>
<div class="admonition warning">
<p class="admonition-title">Experimental - Not Reviewed</p>
<p>Content may be incomplete or inaccurate.</p>
</div>
<p>This document explains the fundamental concepts that underpin StarryNight's architecture and the rationale behind key design decisions. Understanding these principles and trade-offs is essential for working effectively with the framework.</p>
<h2 id="pipeline-terminology">Pipeline Terminology</h2>
<p>The term "pipeline" has two distinct meanings in StarryNight:</p>
<ul>
<li><strong>CellProfiler Pipeline</strong> (.cppipe files): Image processing pipeline definition that contains CellProfiler modules and parameters, generated by algorithm functions, and executed by CellProfiler software.</li>
<li><strong>StarryNight Pipeline</strong> (Pipecraft graphs): Workflow orchestration pipeline that connects multiple modules into workflows, defines execution order and parallelism, and is executed by backends like Snakemake.</li>
</ul>
<p>Use "CellProfiler pipeline" or ".cppipe" for image processing definitions, "workflow pipeline" or "Pipecraft pipeline" for StarryNight orchestration, and rely on context to make the distinction clear.</p>
<h2 id="core-architecture">Core Architecture</h2>
<h3 id="layered-architecture">Layered Architecture</h3>
<p>StarryNight employs a strict layered architecture where each layer depends only on layers below it:</p>
<ul>
<li><strong>Upward Dependencies Only</strong>: Higher layers import from lower layers, never the reverse</li>
<li><strong>Clean Interfaces</strong>: Each layer exposes well-defined interfaces</li>
<li><strong>Progressive Enhancement</strong>: Each layer adds capabilities without modifying lower layers</li>
<li><strong>Testability</strong>: Lower layers can be tested in isolation</li>
</ul>
<p><strong>Rationale</strong>: This design provides testability (lower layers can be tested without framework setup), reusability (algorithm functions work outside StarryNight), maintainability (changes in lower layers don't break higher layers), and clear contracts (each layer has well-defined interfaces).</p>
<p><strong>Trade-offs</strong>: More layers mean more abstraction overhead, requires discipline to maintain layer boundaries, and may duplicate some logic across layers.</p>
<h3 id="algorithm-independence">Algorithm Independence</h3>
<p>The algorithm layer's complete independence is fundamental to StarryNight's design. Algorithm functions are implemented as standalone Python functions that accept standard Python types as inputs and produce outputs using only Python standard library and common third-party libraries.</p>
<p><strong>Rationale</strong>: Algorithm layer has zero dependencies on other StarryNight components to ensure portability (algorithms can be used in any Python environment), testing (no framework setup required for unit tests), clarity (business logic separated from infrastructure), and evolution (framework can change without affecting algorithms).</p>
<h2 id="layer-specific-patterns">Layer-Specific Patterns</h2>
<h3 id="specification-vs-implementation">Specification vs Implementation</h3>
<p>StarryNight separates "what" from "how" at multiple levels:</p>
<ul>
<li><strong>Module Level</strong>: Specification (Bilayers) defines inputs, outputs, and parameters; compute graph (Pipecraft) defines execution structure; and execution (backend) performs actual computation.</li>
<li><strong>Pipeline Level</strong>: Definition provides abstract workflow description, translation creates backend-specific execution plan, and runtime performs actual process execution.</li>
</ul>
<p><strong>Rationale</strong>: Modules define both specifications (Bilayers) and compute graphs (Pipecraft) to achieve backend independence (same module runs on different platforms), inspection (can examine workflow before execution), UI generation (specs enable automatic interface creation), and validation (type checking before runtime).</p>
<p><strong>Trade-offs</strong>: Additional complexity in maintaining both specifications and implementations, requires understanding of multiple abstraction layers.</p>
<h3 id="module-layer-as-cli-wrapper">Module Layer as CLI Wrapper</h3>
<p>Modules invoke CLI commands rather than calling algorithms directly. This provides consistency (single execution path for all invocations), isolation (container boundaries match CLI boundaries), testing (CLI provides natural integration test points), and debugging (can manually run same commands modules generate).</p>
<p><strong>Rationale</strong>: Using CLI as the interface layer ensures all execution paths go through the same validated entry points, making behavior predictable and debugging straightforward.</p>
<p><strong>Trade-offs</strong>: Additional overhead of process creation, string-based command construction.</p>
<h3 id="three-function-pattern-cellprofiler-workflows">Three-Function Pattern (CellProfiler Workflows)</h3>
<p>CellProfiler-based workflows in StarryNight follow a consistent three-step pattern:</p>
<ol>
<li><strong>LoadData Generation</strong>: Identifies what images to process by reading indexes/inventories, filtering by criteria, and outputting CSV files for CellProfiler.</li>
<li><strong>Pipeline Generation</strong>: Defines how to process images by inferring parameters from sample data, configuring CellProfiler modules, and outputting .cppipe pipeline definitions.</li>
<li><strong>Execution</strong>: Runs the CellProfiler pipeline by managing parallel execution and organizing outputs.</li>
</ol>
<p><strong>Rationale</strong>: Organizing CellProfiler algorithm sets around LoadData → Pipeline → Execution pattern provides consistency (same pattern across CellProfiler analyses), modularity (each step has clear purpose), flexibility (can mix and match components), and understanding (predictable structure aids comprehension).</p>
<p><strong>Clarification</strong>: Other algorithm types (indexing, inventory, quality control) follow different patterns based on their purpose.</p>
<h2 id="module-pipeline-concepts">Module &amp; Pipeline Concepts</h2>
<h3 id="module-composition">Module Composition</h3>
<p>Modules compose into pipelines through typed interfaces, execution patterns, and resource management:</p>
<ul>
<li><strong>Input/Output Contracts</strong>: Typed interfaces define connections, outputs of one module feed inputs of another, and type checking ensures compatibility.</li>
<li><strong>Execution Patterns</strong>: Sequential blocks for dependent operations, parallel blocks for independent operations, and nested blocks for complex workflows.</li>
<li><strong>Resource Management</strong>: Modules declare resource requirements, execution layer manages allocation, and automatic cleanup after completion.</li>
</ul>
<p><strong>Rationale</strong>: Build complex workflows by composing simple modules to achieve flexibility (mix and match components), testing (test modules independently), reuse (share modules across workflows), and understanding (smaller units easier to comprehend).</p>
<h3 id="pipecraft-as-separate-package">Pipecraft as Separate Package</h3>
<p>Pipeline construction is implemented as a separate package within the monorepo. This provides focus (clean separation of concerns), reusability (could be used by other projects), testing (independent test suite), and evolution (can evolve independently).</p>
<p><strong>Rationale</strong>: Separating workflow construction from core StarryNight functionality allows the pipeline engine to evolve independently and potentially be reused by other projects with similar needs.</p>
<p><strong>Clarification</strong>: Pipecraft creates StarryNight workflow pipelines (compute graphs), not CellProfiler pipelines (.cppipe files).</p>
<h2 id="cross-cutting-concerns">Cross-Cutting Concerns</h2>
<h3 id="path-abstraction">Path Abstraction</h3>
<p>All StarryNight components use cloudpathlib's <code>AnyPath</code> for storage abstraction. The cloudpathlib AnyPath abstraction provides a unified interface for accessing both local filesystem paths and cloud storage locations (S3, Google Cloud Storage, Azure Blob Storage).</p>
<p><strong>Rationale</strong>: Using <code>AnyPath</code> abstraction for all file operations provides storage agnostic code (same code for local/S3/GCS), future proofing (easy to add new storage backends), clean code (no if/else for different path types), and testing (can mock storage in tests).</p>
<p><strong>Trade-offs</strong>: Adds dependency on cloudpathlib and may have slight performance overhead compared to native path operations.</p>
<h3 id="container-based-execution">Container-Based Execution</h3>
<p>All processing runs in containers to ensure reproducibility (fixed software versions, isolated dependencies, consistent environments), portability (runs on any container platform, cloud-native execution, local development mirrors production), and scalability (parallel container instances, resource isolation, efficient scheduling).</p>
<p><strong>Rationale</strong>: Container-based execution with explicit specifications ensures reproducibility (fixed versions and dependencies), portability (same containers run locally and in cloud), isolation (no dependency conflicts), and scalability (natural unit for parallel execution).</p>
<p><strong>Trade-offs</strong>: Container overhead for small operations, requires container runtime, and more complex local development setup.</p>
<h3 id="parameter-inference">Parameter Inference</h3>
<p>StarryNight minimizes configuration through intelligent inference:</p>
<ul>
<li><strong>Index Analysis</strong>: Extract metadata from data</li>
<li><strong>Sample Inspection</strong>: Infer parameters from representative files</li>
<li><strong>Smart Defaults</strong>: Provide sensible defaults for common cases</li>
<li><strong>User Override</strong>: Allow explicit configuration when needed</li>
</ul>
<p><strong>Rationale</strong>: Infer parameters from data when possible rather than requiring explicit configuration to improve user experience (less configuration burden), correctness (parameters match actual data), adaptability (automatically adjusts to data changes), and defaults (smart defaults for common cases).</p>
<p><strong>Trade-offs</strong>: More complex implementation logic, potential for incorrect inference in edge cases, and debugging complexity when inference fails.</p>
<p><strong>Example</strong>: The system infers parameters from data when possible (e.g., counting unique channels from the index) rather than requiring users to specify values that can be determined automatically.</p>
<h3 id="cross-cutting-configuration">Cross-Cutting Configuration</h3>
<p>The configuration layer operates orthogonally to other layers, influencing behavior across the entire stack. This enables consistent parameters across layers, experiment-specific adaptations, and runtime behavior modification.</p>
<p><strong>Trade-offs</strong>: More complex parameter resolution logic and potential for configuration conflicts across layers.</p>
<h2 id="execution-backend">Execution &amp; Backend</h2>
<h3 id="backend-abstraction">Backend Abstraction</h3>
<p>StarryNight supports multiple execution backends through abstraction:</p>
<ul>
<li><strong>Current: Snakemake</strong> - Rule-based workflow engine with automatic dependency resolution and built-in parallelism.</li>
<li><strong>Possible: Others</strong> - AWS Batch, Google Cloud Run, Kubernetes, and local execution.</li>
</ul>
<p><strong>Rationale</strong>: Using Snakemake as the first execution backend provides maturity (battle-tested in bioinformatics), features (built-in parallelism, dependency resolution), community (active development and support), and flexibility (supports local and cluster execution). The architecture allows adding other backends (Nextflow, CWL, etc.) in the future.</p>
<p><strong>Trade-offs</strong>: Initial implementation tied to Snakemake's execution model, requires abstraction layer to support multiple backends effectively.</p>
<h2 id="development-practices">Development Practices</h2>
<h3 id="error-handling-philosophy">Error Handling Philosophy</h3>
<p>StarryNight follows consistent error handling principles:</p>
<ul>
<li><strong>Fail Fast</strong>: Detect problems early</li>
<li><strong>Clear Messages</strong>: Provide actionable error information</li>
<li><strong>Graceful Degradation</strong>: Continue processing unaffected data</li>
<li><strong>Audit Trail</strong>: Log all operations for debugging</li>
</ul>
<p><strong>Rationale</strong>: Consistent error handling across all layers improves debugging experience, reduces time to resolution, and enables partial processing of large datasets when some components fail.</p>
<p><strong>Trade-offs</strong>: Requires discipline to implement consistently and may add verbosity to error handling code.</p>
<h3 id="testing-strategy">Testing Strategy</h3>
<p>StarryNight employs layer-specific testing approaches, though implementation is currently in progress:</p>
<p><strong>Current Implementation</strong>:</p>
<ul>
<li><strong>Algorithm</strong>: Unit tests for core algorithms (e.g., index generation)</li>
<li><strong>Integration</strong>: End-to-end workflow tests for key use cases</li>
<li><strong>Parsers</strong>: Component tests for data parsing functionality</li>
<li><strong>Utilities</strong>: Unit tests for helper functions</li>
</ul>
<p><strong>Planned Implementation</strong>:</p>
<ul>
<li><strong>CLI</strong>: Integration tests with command execution</li>
<li><strong>Module</strong>: Specification validation tests</li>
<li><strong>Pipeline</strong>: Composition and graph tests</li>
<li><strong>Execution</strong>: Backend-specific execution tests</li>
<li><strong>Configuration</strong>: Parameter inference tests</li>
</ul>
<p><strong>Rationale</strong>: Layer-specific testing strategies should match the abstraction level and purpose of each component, enabling comprehensive coverage without unnecessary complexity.</p>
<p><strong>Trade-offs</strong>: Requires maintaining multiple test suites and understanding different testing approaches for different layers.</p>
<h2 id="trade-off-summary">Trade-off Summary</h2>
<table>
<thead>
<tr>
<th>Decision</th>
<th>Benefits</th>
<th>Costs</th>
</tr>
</thead>
<tbody>
<tr>
<td>Layered Architecture</td>
<td>Clear boundaries, testability</td>
<td>Abstraction overhead</td>
</tr>
<tr>
<td>Algorithm Independence</td>
<td>Portability, simplicity</td>
<td>No framework features</td>
</tr>
<tr>
<td>CLI Wrapping</td>
<td>Consistency, isolation</td>
<td>Process overhead</td>
</tr>
<tr>
<td>Container Execution</td>
<td>Reproducibility, scalability</td>
<td>Setup complexity</td>
</tr>
<tr>
<td>Parameter Inference</td>
<td>Better UX, correctness</td>
<td>Complex implementation</td>
</tr>
</tbody>
</table>
<p>These decisions create a system that prioritizes:</p>
<ol>
<li><strong>Reproducibility</strong> over convenience</li>
<li><strong>Flexibility</strong> over simplicity</li>
<li><strong>Explicitness</strong> over magic</li>
<li><strong>Composition</strong> over monoliths</li>
</ol>
<p>Future architectural decisions should align with these principles while pragmatically addressing user needs.</p>
<h2 id="next-steps">Next Steps</h2>
<p>For implementation details, see the individual layer documentation files (01-algorithm.md through 06-configuration.md).</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>