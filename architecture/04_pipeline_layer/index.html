
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="StarryNight - toolkit for optical pooled screening">
      
      
      
      
        <link rel="prev" href="../03_module_layer/">
      
      
        <link rel="next" href="../05_execution_layer/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Pipeline Layer - StarryNight</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#starrynight-pipeline-layer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="StarryNight" class="md-header__button md-logo" aria-label="StarryNight" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            StarryNight
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pipeline Layer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/broadinstitute/starrynight" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user/getting-started/" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/guides/system-maintenance-guide/" class="md-tabs__link">
          
  
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../00_architecture_overview/" class="md-tabs__link">
          
  
  
    
  
  Developer Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecturev2/" class="md-tabs__link">
          
  
  
    
  
  Developer Architecture (v2)

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/validation/testing-framework/" class="md-tabs__link">
          
  
  
    
  
  Developer Testing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/roadmap/requirements/" class="md-tabs__link">
          
  
  
    
  
  Developer Roadmap

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../developer/legacy/pcpip-specs/" class="md-tabs__link">
          
  
  
    
  
  Developer Legacy

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="StarryNight" class="md-nav__button md-logo" aria-label="StarryNight" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    StarryNight
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/broadinstitute/starrynight" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/example-pipeline-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Complete Workflow Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/parser-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parser Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/operational-challenges/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operational Challenges FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/guides/system-maintenance-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Maintenance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/guides/workflow-implementation-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflow Implementation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Developer Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00_architecture_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_algorithm_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_cli_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_module_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Pipeline Layer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Pipeline Layer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipecraft-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipecraft Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipecraft-as-a-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft as a Foundation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipecraft-as-a-separate-package" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft as a Separate Package
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipecrafts-dual-role" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft's Dual Role
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-pipecraft-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Pipecraft Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Pipecraft Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequential-and-parallel-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential and Parallel Blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-nodes-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Container Nodes and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simple-vs-complex-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Simple vs. Complex Pipelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Composition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Composition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline-composition-function" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Composition Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-creation-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Module Creation and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-pipeline-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Building the Pipeline Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-and-sequential-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel and Sequential Blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressing-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Expressing Parallelism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Expressing Parallelism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#between-steps-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Between Steps Parallelism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#within-steps-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Within Steps Parallelism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unit-of-work-api" class="md-nav__link">
    <span class="md-ellipsis">
      Unit of Work API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-complete-pipeline-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Complete Pipeline Composition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notebook-example-for-pipeline-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Notebook Example for Pipeline Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-modules-after-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying Modules After Composition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-power-of-automatic-generation" class="md-nav__link">
    <span class="md-ellipsis">
      The Power of Automatic Generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relationship-to-adjacent-layers" class="md-nav__link">
    <span class="md-ellipsis">
      Relationship to Adjacent Layers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_execution_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_configuration_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_architecture_for_biologists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture for Biologists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08_practical_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Practical Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09_architecture_flow_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flow Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../architecturev2/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developer Architecture (v2)
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developer Architecture (v2)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/00-1-principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Principles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/01-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithm Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/02-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/03-module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/04-pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/05-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/06-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecturev2/99-0-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/validation/testing-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Framework
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/validation/validation-pipeline-1-illum-calc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Validation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Roadmap
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Developer Roadmap
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/roadmap/requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/roadmap/pipeline-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Automation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/roadmap/aws-deployment-roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Deployment Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Legacy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Developer Legacy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/legacy/pcpip-specs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PCPIP Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/legacy/pcpip-pipelines/pcpip-pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PCPIP Reference Pipelines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipecraft-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipecraft Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipecraft-as-a-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft as a Foundation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipecraft-as-a-separate-package" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft as a Separate Package
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipecrafts-dual-role" class="md-nav__link">
    <span class="md-ellipsis">
      Pipecraft's Dual Role
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-pipecraft-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Pipecraft Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Pipecraft Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequential-and-parallel-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential and Parallel Blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-nodes-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Container Nodes and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simple-vs-complex-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Simple vs. Complex Pipelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Composition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Composition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline-composition-function" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Composition Function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-creation-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Module Creation and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-the-pipeline-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Building the Pipeline Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-and-sequential-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel and Sequential Blocks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressing-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Expressing Parallelism
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Expressing Parallelism">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#between-steps-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Between Steps Parallelism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#within-steps-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Within Steps Parallelism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unit-of-work-api" class="md-nav__link">
    <span class="md-ellipsis">
      Unit of Work API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-complete-pipeline-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Complete Pipeline Composition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notebook-example-for-pipeline-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Notebook Example for Pipeline Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-modules-after-composition" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying Modules After Composition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-power-of-automatic-generation" class="md-nav__link">
    <span class="md-ellipsis">
      The Power of Automatic Generation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relationship-to-adjacent-layers" class="md-nav__link">
    <span class="md-ellipsis">
      Relationship to Adjacent Layers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="starrynight-pipeline-layer">StarryNight Pipeline Layer</h1>
<h2 id="overview">Overview</h2>
<p>The pipeline layer in StarryNight combines two critical aspects: Pipecraft integration for defining compute graphs and pipeline composition for building complete workflows. This layer represents the highest level of abstraction in the StarryNight architecture, sitting above the module layer and below the execution layer.</p>
<p>The pipeline layer enables the creation, composition, and preparation of complex image processing workflows by connecting modules into complete pipelines with well-defined execution patterns. It establishes a clear separation between pipeline definition (what should be done and how it's structured) and execution (how it's actually run), which is a fundamental architectural principle of StarryNight.</p>
<h2 id="purpose">Purpose</h2>
<p>The pipeline layer serves several key purposes in the StarryNight architecture:</p>
<ol>
<li><strong>Compute Graph Definition</strong> - Creating structured representations of computational tasks</li>
<li><strong>Container Configuration</strong> - Specifying container settings for isolated execution</li>
<li><strong>Pipeline Composition</strong> - Combining operations into cohesive workflows</li>
<li><strong>Backend Independence</strong> - Separating pipeline definition from execution</li>
<li><strong>Parallelism Specification</strong> - Defining which operations can run in parallel</li>
<li><strong>Workflow Definition</strong> - Creating end-to-end processing workflows</li>
<li><strong>Module Coordination</strong> - Connecting modules in the correct sequence</li>
<li><strong>Execution Preparation</strong> - Preparing the complete pipeline for execution</li>
</ol>
<p>These capabilities enable the creation of complex, reproducible workflows for scientific image processing while maintaining a clean separation between definition and execution.</p>
<h2 id="pipecraft-integration">Pipecraft Integration</h2>
<h3 id="pipecraft-as-a-foundation">Pipecraft as a Foundation</h3>
<p>Pipecraft is a library that enables the creation of composable pipeline graphs in StarryNight. It provides primitives for defining computational operations, containers, and their connections, allowing modules to generate executable compute graphs without being tied to specific execution backends.</p>
<p>Pipecraft serves as the technical foundation for pipeline construction in StarryNight, providing:</p>
<ol>
<li>A standardized framework for defining computational operations</li>
<li>Clear abstractions for organizing operations (sequential, parallel)</li>
<li>Container definitions independent of execution technology</li>
<li>Input/output relationship specifications for pipeline steps</li>
</ol>
<h3 id="pipecraft-as-a-separate-package">Pipecraft as a Separate Package</h3>
<p>Pipecraft is a separate package within the StarryNight monorepo that provides the foundational pipeline construction capabilities. While most modules and algorithms live in the StarryNight core package, the pipeline construction functionality is implemented in Pipecraft, which:</p>
<ul>
<li>Provides a generic pipeline definition framework</li>
<li>Is developed independently but within the same repository</li>
<li>Implements a backend-agnostic approach to pipeline execution</li>
<li>Could potentially be used by other systems beyond StarryNight</li>
</ul>
<p>This separation allows for focused development of pipeline construction capabilities while maintaining integration with the broader StarryNight framework.</p>
<h3 id="pipecrafts-dual-role">Pipecraft's Dual Role</h3>
<p>Pipecraft serves two essential functions in the StarryNight architecture:</p>
<ol>
<li><strong>Pipeline Definition</strong>: Creating compute graphs that represent operations and their relationships</li>
<li><strong>Execution Backend Support</strong>: Providing backends to execute the defined compute graphs</li>
</ol>
<p>This dual capability - both defining compute graphs AND providing execution backends - makes Pipecraft the central technical component that enables the separation between definition and execution, which is fundamental to the entire system.</p>
<p>In the StarryNight architecture, Pipecraft integration happens inside modules. The module layer uses Bilayers to create specifications, and then interfaces with Pipecraft to define how those specifications should be executed as compute graphs. This marks the transition from specification (what needs to be done) to implementation (how to do it).</p>
<h3 id="core-pipecraft-concepts">Core Pipecraft Concepts</h3>
<h4 id="pipeline">Pipeline</h4>
<p>A <code>Pipeline</code> is the root object that represents the complete compute graph:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span>
</span></code></pre></div>
<p>This object serves as the container for all operations and their relationships.</p>
<h4 id="sequential-and-parallel-blocks">Sequential and Parallel Blocks</h4>
<p>Pipecraft provides context managers for defining execution order:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Sequential execution (operations run one after another)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">seq</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="c1"># Operations defined here run in sequence</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># Parallel execution (operations can run simultaneously)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span> <span class="k">as</span> <span class="n">par</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="c1"># Operations defined here can run in parallel</span>
</span></code></pre></div>
<p>These blocks can be nested to create complex execution patterns with multiple layers of sequential and parallel operations.</p>
<h3 id="container-nodes-and-configuration">Container Nodes and Configuration</h3>
<p>Container nodes represent operations that run in containerized environments:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">seq</span><span class="o">.</span><span class="n">container</span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;operation_name&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="s2">&quot;input_name&quot;</span><span class="p">:</span> <span class="s2">&quot;input_path&quot;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="p">},</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        <span class="s2">&quot;output_name&quot;</span><span class="p">:</span> <span class="s2">&quot;output_path&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="p">},</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="n">container_config</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">ContainerConfig</span><span class="p">(</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="n">image</span><span class="o">=</span><span class="s2">&quot;container/image:tag&quot;</span><span class="p">,</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="s2">&quot;arg1&quot;</span><span class="p">,</span> <span class="s2">&quot;arg2&quot;</span><span class="p">]</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="p">)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="p">)</span>
</span></code></pre></div>
<p>ContainerConfig objects specify the container execution environment:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">pc</span><span class="o">.</span><span class="n">ContainerConfig</span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">image</span><span class="o">=</span><span class="s2">&quot;cellprofiler/starrynight:latest&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">environment</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="s2">&quot;ENV_VAR&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="p">}</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">)</span>
</span></code></pre></div>
<p>A critical aspect of Pipecraft integration is container specification. This standardizes how containers should be executed, with specific images, commands, and environment variables. This containerization provides isolation and reproducibility.</p>
<p>The container specification is runtime-agnostic. It defines what should be run in a container but leaves the specifics of how to execute that container to the execution backend. This abstraction allows the same pipeline to run with different container technologies (Docker, Singularity/Apptainer) depending on the execution environment.</p>
<h3 id="simple-vs-complex-pipelines">Simple vs. Complex Pipelines</h3>
<p>For single-module operations, pipelines are simple and may contain just one node. This might seem redundant, but since compute graphs are composable, even simple operations follow the same pattern to enable later integration into more complex pipelines.</p>
<p>More complex pipelines can connect multiple operations:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">seq</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="c1"># First operation</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">node1</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">container</span><span class="p">(</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;operation1&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>        <span class="c1"># config...</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="c1"># Second operation</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">node2</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">container</span><span class="p">(</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;operation2&quot;</span><span class="p">,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="c1"># config...</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="p">)</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="c1"># Connect nodes</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="n">pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">node1</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">],</span> <span class="n">node2</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">])</span>
</span></code></pre></div>
<h2 id="pipeline-composition">Pipeline Composition</h2>
<p>Pipeline composition is the final layer of abstraction in StarryNight, allowing multiple modules to be combined into complete workflows.</p>
<h3 id="pipeline-composition-function">Pipeline Composition Function</h3>
<p>Pipeline composition is typically implemented as a function that takes configurations and returns a composed pipeline:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_pcp_generic_pipeline</span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="n">data_config</span><span class="p">:</span> <span class="n">DataConfig</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">experiment</span><span class="p">:</span> <span class="n">PCPGenericExperiment</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">StarryNightModule</span><span class="p">],</span> <span class="n">pc</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">]:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="sd">    Create a complete PCP generic pipeline.</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="sd">    Parameters</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="sd">    ----------</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="sd">    data_config : DataConfig</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="sd">        Data configuration with paths</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="sd">    experiment : PCPGenericExperiment</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="sd">        Experiment configuration</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="sd">    Returns</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="sd">    -------</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="sd">    Tuple[List[StarryNightModule], pc.Pipeline]</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="sd">        List of configured modules and the composed pipeline</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="c1"># Implementation...</span>
</span></code></pre></div>
<h3 id="module-creation-and-configuration">Module Creation and Configuration</h3>
<p>The pipeline composition function first creates and configures all necessary modules:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Create modules</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># Index and inventory</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">index_module</span> <span class="o">=</span> <span class="n">GenIndexModule</span><span class="p">(</span><span class="n">data_config</span><span class="p">)</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_module</span><span class="p">)</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">inventory_module</span> <span class="o">=</span> <span class="n">GenInvModule</span><span class="p">(</span><span class="n">data_config</span><span class="p">)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inventory_module</span><span class="p">)</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="c1"># Cell Painting modules</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">cp_illum_calc_load_data</span> <span class="o">=</span> <span class="n">CPIllumCalcGenLoadDataModule</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_load_data</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">cp_illum_calc_pipeline</span> <span class="o">=</span> <span class="n">CPIllumCalcGenCPipeModule</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_pipeline</span><span class="p">)</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="c1"># More module creation...</span>
</span></code></pre></div>
<p>Each module is created and configured based on data and experiment configurations. This approach ensures that all modules have the necessary information to function correctly within the pipeline.</p>
<h3 id="building-the-pipeline-structure">Building the Pipeline Structure</h3>
<p>After creating modules, the function constructs the pipeline structure using Pipecraft's sequential and parallel blocks:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Create main pipeline</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">main_seq</span><span class="p">:</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="c1"># First run index and inventory</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">setup_seq</span><span class="p">:</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        <span class="n">setup_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">index_module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="n">setup_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">inventory_module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="c1"># Then run CP and SBS in parallel</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span> <span class="k">as</span> <span class="n">parallel_proc</span><span class="p">:</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="c1"># CP pipeline branch</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>        <span class="k">with</span> <span class="n">parallel_proc</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">cp_seq</span><span class="p">:</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>            <span class="n">cp_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">cp_illum_calc_load_data</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>            <span class="n">cp_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">cp_illum_calc_pipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>            <span class="c1"># Add more CP modules...</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="c1"># SBS pipeline branch</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>        <span class="k">with</span> <span class="n">parallel_proc</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">sbs_seq</span><span class="p">:</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>            <span class="n">sbs_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">sbs_illum_calc_load_data</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>            <span class="n">sbs_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">sbs_illum_calc_pipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>            <span class="c1"># Add more SBS modules...</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>    <span class="c1"># Finally run analysis</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>    <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">analysis_seq</span><span class="p">:</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>        <span class="n">analysis_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">analysis_load_data</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>        <span class="n">analysis_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">analysis_pipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span></code></pre></div>
<p>This structure defines both sequencing and parallelism in the pipeline. Note how modules are not directly added to the pipeline; instead, their pipeline properties are added using <code>add_pipeline()</code>. This ensures that each module's compute graph is properly integrated into the overall pipeline.</p>
<p>The composition function returns both the configured modules and the composed pipeline:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">return</span> <span class="n">modules</span><span class="p">,</span> <span class="n">pipeline</span>
</span></code></pre></div>
<p>This allows users to access both the individual modules (for inspection or modification) and the complete pipeline (for execution).</p>
<p>Returning both the modules and the pipeline enables advanced usage patterns where modules can be individually inspected or modified, and then the pipeline can be recreated with the updated modules. This is particularly valuable for interactive development in notebook environments.</p>
<h3 id="parallel-and-sequential-blocks">Parallel and Sequential Blocks</h3>
<p>The pipeline composition can express complex execution patterns through nested sequential and parallel blocks:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">main_seq</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="c1"># First step runs sequentially</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">first_step</span><span class="p">:</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>        <span class="c1"># Operations that must run one after another</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>        <span class="n">first_step</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module1</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>        <span class="n">first_step</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module2</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="c1"># Second step has parallel branches</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span> <span class="k">as</span> <span class="n">parallel_branches</span><span class="p">:</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        <span class="c1"># Branch A runs sequentially</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>        <span class="k">with</span> <span class="n">parallel_branches</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">branch_a</span><span class="p">:</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>            <span class="n">branch_a</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module3</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>            <span class="n">branch_a</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module4</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>        <span class="c1"># Branch B runs sequentially</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="k">with</span> <span class="n">parallel_branches</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">branch_b</span><span class="p">:</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>            <span class="n">branch_b</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module5</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>            <span class="n">branch_b</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module6</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="c1"># Final step runs after all parallel branches complete</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>    <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">final_step</span><span class="p">:</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        <span class="n">final_step</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module7</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span></code></pre></div>
<p>This structure allows for expressing complex workflows with appropriate dependencies and execution patterns.</p>
<h2 id="expressing-parallelism">Expressing Parallelism</h2>
<p>The pipeline layer handles parallelism at multiple levels, allowing for efficient execution of complex workflows.</p>
<h3 id="between-steps-parallelism">Between Steps Parallelism</h3>
<p>The pipeline composition can express parallelism between different steps. For example, Cell Painting and Sequencing By Synthesis processing can run independently until they reach a point where they need to be combined for analysis.</p>
<p>This is expressed using parallel blocks in the pipeline composition:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span> <span class="k">as</span> <span class="n">par</span><span class="p">:</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="c1"># These branches run in parallel</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="k">with</span> <span class="n">par</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">branch_a</span><span class="p">:</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>        <span class="c1"># Operations in branch A</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="k">with</span> <span class="n">par</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">branch_b</span><span class="p">:</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        <span class="c1"># Operations in branch B</span>
</span></code></pre></div>
<h3 id="within-steps-parallelism">Within Steps Parallelism</h3>
<p>There's also parallelism within specific steps. For instance, illumination correction can be applied to multiple images simultaneously.</p>
<p>This can be expressed using parallel operations within a module:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pc</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create compute graph with parallel processing.&quot;&quot;&quot;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="c1"># Get samples from spec</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;samples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">seq</span><span class="p">:</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>        <span class="c1"># First create output directory</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="n">setup</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">container</span><span class="p">(</span><span class="o">/*</span> <span class="o">...</span> <span class="o">*/</span><span class="p">)</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="c1"># Then process samples in parallel</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="k">with</span> <span class="n">seq</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span> <span class="k">as</span> <span class="n">par</span><span class="p">:</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>            <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>                <span class="c1"># Each sample processed in parallel</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>                <span class="n">par</span><span class="o">.</span><span class="n">container</span><span class="p">(</span><span class="o">/*</span> <span class="o">...</span> <span class="o">*/</span><span class="p">)</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="k">return</span> <span class="n">pipeline</span>
</span></code></pre></div>
<p>This approach maximizes efficiency by processing independent items concurrently.</p>
<h3 id="unit-of-work-api">Unit of Work API</h3>
<p>An experimental API for expressing finer-grained parallelism within operations is being developed. This "unit of work" API aims to express more detailed parallelism within operations, allowing for better resource utilization in complex workflows. However, this API is still under development and not yet widely used in production workflows.</p>
<h2 id="pipeline-execution">Pipeline Execution</h2>
<p>Once a pipeline is composed, it can be executed using a backend:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Create pipeline</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">modules</span><span class="p">,</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">create_pcp_generic_pipeline</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">pcp_experiment</span><span class="p">)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># Configure backend</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">backend_config</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">SnakemakeBackendConfig</span><span class="p">(</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">use_opentelemetry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="n">print_exec</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="p">)</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="n">exec_backend</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">SnakemakeBackend</span><span class="p">(</span><span class="n">backend_config</span><span class="p">)</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="c1"># Execute pipeline</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="n">exec_backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="n">config</span><span class="o">=</span><span class="n">backend_config</span><span class="p">,</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>    <span class="n">working_dir</span><span class="o">=</span><span class="n">data_config</span><span class="o">.</span><span class="n">scratch_path</span> <span class="o">/</span> <span class="s2">&quot;runs&quot;</span> <span class="o">/</span> <span class="s2">&quot;complete_pipeline&quot;</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="p">)</span>
</span></code></pre></div>
<p>This executes the entire workflow in a single operation. The Snakemake backend, which is the primary execution backend in StarryNight, translates the Pipecraft pipeline into a Snakemake workflow and executes it. This process is covered in detail in the <a href="../05_execution_layer/">Execution Layer</a> section.</p>
<p>All pipeline steps run in containers, ensuring reproducibility and isolation. The Snakemake backend handles the execution of composed pipelines across various infrastructures that support Snakemake.</p>
<h2 id="complete-examples">Complete Examples</h2>
<h3 id="example-complete-pipeline-composition">Example: Complete Pipeline Composition</h3>
<p>Here's a detailed example of pipeline composition:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_pcp_generic_pipeline</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">):</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create complete PCP generic pipeline.&quot;&quot;&quot;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="c1"># Create all modules</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="c1"># Setup modules</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="n">index_module</span> <span class="o">=</span> <span class="n">GenIndexModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">)</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_module</span><span class="p">)</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    <span class="n">inventory_module</span> <span class="o">=</span> <span class="n">GenInvModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inventory_module</span><span class="p">)</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="c1"># Cell Painting modules</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="n">cp_modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>    <span class="n">cp_illum_calc_load_data</span> <span class="o">=</span> <span class="n">CPIllumCalcGenLoadDataModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_load_data</span><span class="p">)</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_load_data</span><span class="p">)</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>    <span class="n">cp_illum_calc_pipeline</span> <span class="o">=</span> <span class="n">CPIllumCalcGenCPipeModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_pipeline</span><span class="p">)</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_pipeline</span><span class="p">)</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>    <span class="n">cp_illum_calc_run</span> <span class="o">=</span> <span class="n">CPIllumCalcRunModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_run</span><span class="p">)</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_calc_run</span><span class="p">)</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>    <span class="n">cp_illum_apply_load_data</span> <span class="o">=</span> <span class="n">CPIllumApplyGenLoadDataModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_apply_load_data</span><span class="p">)</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_apply_load_data</span><span class="p">)</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>    <span class="n">cp_illum_apply_pipeline</span> <span class="o">=</span> <span class="n">CPIllumApplyGenCPipeModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_apply_pipeline</span><span class="p">)</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_apply_pipeline</span><span class="p">)</span>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>    <span class="n">cp_illum_apply_run</span> <span class="o">=</span> <span class="n">CPIllumApplyRunModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_apply_run</span><span class="p">)</span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_illum_apply_run</span><span class="p">)</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>    <span class="n">cp_segcheck_load_data</span> <span class="o">=</span> <span class="n">CPSegcheckGenLoadDataModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_segcheck_load_data</span><span class="p">)</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_segcheck_load_data</span><span class="p">)</span>
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>    <span class="n">cp_segcheck_pipeline</span> <span class="o">=</span> <span class="n">CPSegcheckGenCPipeModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_segcheck_pipeline</span><span class="p">)</span>
</span><span id="__span-13-46"><a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_segcheck_pipeline</span><span class="p">)</span>
</span><span id="__span-13-47"><a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>
</span><span id="__span-13-48"><a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>    <span class="n">cp_segcheck_run</span> <span class="o">=</span> <span class="n">CPSegcheckRunModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-49"><a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>    <span class="n">cp_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_segcheck_run</span><span class="p">)</span>
</span><span id="__span-13-50"><a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_segcheck_run</span><span class="p">)</span>
</span><span id="__span-13-51"><a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>
</span><span id="__span-13-52"><a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>    <span class="c1"># SBS modules</span>
</span><span id="__span-13-53"><a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>    <span class="n">sbs_modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-54"><a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>
</span><span id="__span-13-55"><a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>    <span class="n">sbs_illum_calc_load_data</span> <span class="o">=</span> <span class="n">SBSIllumCalcGenLoadDataModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-56"><a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>    <span class="n">sbs_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sbs_illum_calc_load_data</span><span class="p">)</span>
</span><span id="__span-13-57"><a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sbs_illum_calc_load_data</span><span class="p">)</span>
</span><span id="__span-13-58"><a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>
</span><span id="__span-13-59"><a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>    <span class="c1"># Additional SBS modules...</span>
</span><span id="__span-13-60"><a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>
</span><span id="__span-13-61"><a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>    <span class="c1"># Analysis modules</span>
</span><span id="__span-13-62"><a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>    <span class="n">analysis_modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-63"><a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>
</span><span id="__span-13-64"><a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>    <span class="n">analysis_load_data</span> <span class="o">=</span> <span class="n">AnalysisGenLoadDataModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-65"><a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>    <span class="n">analysis_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_load_data</span><span class="p">)</span>
</span><span id="__span-13-66"><a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_load_data</span><span class="p">)</span>
</span><span id="__span-13-67"><a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>
</span><span id="__span-13-68"><a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>    <span class="n">analysis_pipeline</span> <span class="o">=</span> <span class="n">AnalysisGenCPipeModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-69"><a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>    <span class="n">analysis_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_pipeline</span><span class="p">)</span>
</span><span id="__span-13-70"><a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_pipeline</span><span class="p">)</span>
</span><span id="__span-13-71"><a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>
</span><span id="__span-13-72"><a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>    <span class="n">analysis_run</span> <span class="o">=</span> <span class="n">AnalysisRunModule</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
</span><span id="__span-13-73"><a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>    <span class="n">analysis_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_run</span><span class="p">)</span>
</span><span id="__span-13-74"><a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_run</span><span class="p">)</span>
</span><span id="__span-13-75"><a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>
</span><span id="__span-13-76"><a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>    <span class="c1"># Create main pipeline</span>
</span><span id="__span-13-77"><a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span>
</span><span id="__span-13-78"><a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>
</span><span id="__span-13-79"><a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>    <span class="k">with</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">main_seq</span><span class="p">:</span>
</span><span id="__span-13-80"><a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>        <span class="c1"># First run index and inventory</span>
</span><span id="__span-13-81"><a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>        <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">setup_seq</span><span class="p">:</span>
</span><span id="__span-13-82"><a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>            <span class="n">setup_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">index_module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-13-83"><a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>            <span class="n">setup_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">inventory_module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-13-84"><a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>
</span><span id="__span-13-85"><a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>        <span class="c1"># Then run CP and SBS in parallel</span>
</span><span id="__span-13-86"><a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>        <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">parallel</span><span class="p">()</span> <span class="k">as</span> <span class="n">parallel_proc</span><span class="p">:</span>
</span><span id="__span-13-87"><a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>            <span class="c1"># CP pipeline branch</span>
</span><span id="__span-13-88"><a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>            <span class="k">with</span> <span class="n">parallel_proc</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">cp_seq</span><span class="p">:</span>
</span><span id="__span-13-89"><a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>                <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">cp_modules</span><span class="p">:</span>
</span><span id="__span-13-90"><a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>                    <span class="n">cp_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-13-91"><a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>
</span><span id="__span-13-92"><a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>            <span class="c1"># SBS pipeline branch</span>
</span><span id="__span-13-93"><a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>            <span class="k">with</span> <span class="n">parallel_proc</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">sbs_seq</span><span class="p">:</span>
</span><span id="__span-13-94"><a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>                <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">sbs_modules</span><span class="p">:</span>
</span><span id="__span-13-95"><a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>                    <span class="n">sbs_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-13-96"><a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>
</span><span id="__span-13-97"><a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>        <span class="c1"># Finally run analysis</span>
</span><span id="__span-13-98"><a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>        <span class="k">with</span> <span class="n">main_seq</span><span class="o">.</span><span class="n">sequential</span><span class="p">()</span> <span class="k">as</span> <span class="n">analysis_seq</span><span class="p">:</span>
</span><span id="__span-13-99"><a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>            <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">analysis_modules</span><span class="p">:</span>
</span><span id="__span-13-100"><a id="__codelineno-13-100" name="__codelineno-13-100" href="#__codelineno-13-100"></a>                <span class="n">analysis_seq</span><span class="o">.</span><span class="n">add_pipeline</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span>
</span><span id="__span-13-101"><a id="__codelineno-13-101" name="__codelineno-13-101" href="#__codelineno-13-101"></a>
</span><span id="__span-13-102"><a id="__codelineno-13-102" name="__codelineno-13-102" href="#__codelineno-13-102"></a>    <span class="c1"># Return modules and pipeline</span>
</span><span id="__span-13-103"><a id="__codelineno-13-103" name="__codelineno-13-103" href="#__codelineno-13-103"></a>    <span class="k">return</span> <span class="n">modules</span><span class="p">,</span> <span class="n">pipeline</span>
</span></code></pre></div>
<h3 id="notebook-example-for-pipeline-execution">Notebook Example for Pipeline Execution</h3>
<p>Here's a complete notebook example for creating and executing a pipeline:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Import necessary components</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starrynight.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataConfig</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starrynight.experiments.pcp_generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCPGenericExperiment</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starrynight.pipelines.pcp_generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_pcp_generic_pipeline</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pipecraft</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pc</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1"># Set up paths</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="n">workspace_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/workspace&quot;</span><span class="p">)</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="n">images_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/images&quot;</span><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="n">scratch_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/scratch&quot;</span><span class="p">)</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="c1"># Create data config</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="n">data_config</span> <span class="o">=</span> <span class="n">DataConfig</span><span class="p">(</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    <span class="n">workspace_path</span><span class="o">=</span><span class="n">workspace_path</span><span class="p">,</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="n">images_path</span><span class="o">=</span><span class="n">images_path</span><span class="p">,</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="n">scratch_path</span><span class="o">=</span><span class="n">scratch_path</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="p">)</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="c1"># Configure experiment</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="n">pcp_init_config</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="s2">&quot;nuclear_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;DAPI&quot;</span><span class="p">,</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>    <span class="s2">&quot;cell_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;CellMask&quot;</span><span class="p">,</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>    <span class="s2">&quot;mito_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;MitoTracker&quot;</span><span class="p">,</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>    <span class="s2">&quot;barcode_csv_path&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">workspace_path</span> <span class="o">/</span> <span class="s2">&quot;barcodes.csv&quot;</span><span class="p">),</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    <span class="s2">&quot;image_overlap_percentage&quot;</span><span class="p">:</span> <span class="mi">10</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="p">}</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="c1"># Create experiment</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="n">pcp_experiment</span> <span class="o">=</span> <span class="n">PCPGenericExperiment</span><span class="o">.</span><span class="n">from_index</span><span class="p">(</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>    <span class="n">index_path</span><span class="o">=</span><span class="n">data_config</span><span class="o">.</span><span class="n">workspace_path</span> <span class="o">/</span> <span class="s2">&quot;index.yaml&quot;</span><span class="p">,</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="n">init_config</span><span class="o">=</span><span class="n">pcp_init_config</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="p">)</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="c1"># Configure backend</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="n">backend_config</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">SnakemakeBackendConfig</span><span class="p">(</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>    <span class="n">use_opentelemetry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>    <span class="n">print_exec</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="p">)</span>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="n">exec_backend</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">SnakemakeBackend</span><span class="p">(</span><span class="n">backend_config</span><span class="p">)</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="c1"># Create pipeline</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating pipeline...&quot;</span><span class="p">)</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="n">modules</span><span class="p">,</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">create_pcp_generic_pipeline</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">pcp_experiment</span><span class="p">)</span>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="c1"># Run the pipeline</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running pipeline...&quot;</span><span class="p">)</span>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="n">exec_backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>    <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>    <span class="n">config</span><span class="o">=</span><span class="n">backend_config</span><span class="p">,</span>
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>    <span class="n">working_dir</span><span class="o">=</span><span class="n">data_config</span><span class="o">.</span><span class="n">scratch_path</span> <span class="o">/</span> <span class="s2">&quot;runs&quot;</span> <span class="o">/</span> <span class="s2">&quot;complete_pipeline&quot;</span>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="p">)</span>
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline complete!&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="modifying-modules-after-composition">Modifying Modules After Composition</h3>
<p>Even after composition, individual modules can be modified:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Create pipeline</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">modules</span><span class="p">,</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">create_pcp_generic_pipeline</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">pcp_experiment</span><span class="p">)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># Find specific module to modify</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">segcheck_module</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">module_id</span> <span class="o">==</span> <span class="s2">&quot;cp_segcheck_gen_cppipe&quot;</span><span class="p">)</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="c1"># Modify parameter</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="n">segcheck_module</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;nuclear_channel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;Modified_DAPI&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="c1"># Recreate pipeline with modified modules</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="n">_</span><span class="p">,</span> <span class="n">updated_pipeline</span> <span class="o">=</span> <span class="n">create_pcp_generic_pipeline</span><span class="p">(</span><span class="n">data_config</span><span class="p">,</span> <span class="n">pcp_experiment</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="c1"># Execute modified pipeline</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="n">exec_backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="n">pipeline</span><span class="o">=</span><span class="n">updated_pipeline</span><span class="p">,</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    <span class="n">config</span><span class="o">=</span><span class="n">backend_config</span><span class="p">,</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>    <span class="n">working_dir</span><span class="o">=</span><span class="n">data_config</span><span class="o">.</span><span class="n">scratch_path</span> <span class="o">/</span> <span class="s2">&quot;runs&quot;</span> <span class="o">/</span> <span class="s2">&quot;modified_pipeline&quot;</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="p">)</span>
</span></code></pre></div>
<p>This capability to modify modules and then recreate the pipeline highlights the flexibility and power of the StarryNight architecture.</p>
<h2 id="the-power-of-automatic-generation">The Power of Automatic Generation</h2>
<p>One of the most significant benefits of the pipeline construction approach is its ability to generate complex execution plans automatically. The pipeline layer can generate sophisticated Snakemake workflows with hundreds of rules from a high-level pipeline definition.</p>
<p>This automatic generation of complex execution plans is a key value of the entire architecture. It transforms abstract pipeline definitions into concrete, executable workflows without requiring manual creation of complex execution plans.</p>
<p>Using a composed pipeline offers significant advantages over CLI usage:</p>
<ol>
<li><strong>Dependency Management</strong> - Automatic handling of module dependencies</li>
<li><strong>Parallelism</strong> - Automatic parallel execution where possible</li>
<li><strong>Single Command</strong> - Execute the entire workflow with one command</li>
<li><strong>Resource Optimization</strong> - Better resource utilization across steps</li>
<li><strong>Unified Logging</strong> - Consolidated logging and monitoring</li>
<li><strong>Reproducibility</strong> - Containerized execution ensures consistency</li>
<li><strong>Scalability</strong> - Works from laptops to high-performance computing environments</li>
</ol>
<p>The pipeline approach provides automation, structure, and reproducibility beyond what's possible with direct CLI usage.</p>
<h2 id="relationship-to-adjacent-layers">Relationship to Adjacent Layers</h2>
<p>The pipeline layer builds directly on the module layer below it and connects to the execution layer above it:</p>
<ol>
<li>
<p><strong>Module Layer (Below)</strong> - The pipeline layer composes modules defined in the module layer, using their compute graphs as building blocks for larger workflows.</p>
</li>
<li>
<p><strong>Execution Layer (Above)</strong> - The pipeline layer creates pipeline definitions that are executed by the execution layer, which translates them into specific execution technologies (like Snakemake).</p>
</li>
</ol>
<p>This positioning makes the pipeline layer a critical bridge between individual module abstractions and concrete execution plans.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Pipeline construction and composition represent the highest level of abstraction in the StarryNight architecture. By leveraging Pipecraft for compute graph definition and providing a structured approach to composing complete workflows, StarryNight enables complex image processing pipelines to be defined, configured, and executed with clarity and flexibility.</p>
<p>The key architectural achievement is the separation between pipeline definition and execution, allowing the same pipeline to run on different backends while maintaining a consistent definition approach. This separation, combined with the powerful composition capabilities, enables the automatic generation of complex execution plans from high-level abstractions.</p>
<p>The pipeline construction capabilities bridge the gap between individual module execution and complete workflow automation, providing a powerful yet comprehensible system for scientific image processing.</p>
<p><strong>Next: <a href="../05_execution_layer/">Execution Layer</a></strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>